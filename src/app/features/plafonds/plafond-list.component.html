<div class="branch-management-container">
    @if (successMessage()) {
    <div class="success-toast">
        <span class="material-icons-outlined">check_circle</span>
        {{ successMessage() }}
    </div>
    }

    @if (errorMessage()) {
    <div class="error-toast">
        <span class="material-icons-outlined">error</span>
        <span>{{ errorMessage() }}</span>
    </div>
    }

    <!-- HEADER SECTION -->
    <div class="header-section">
        <div class="title-wrapper">
            <h1 class="page-title">Plafond Management</h1>
            <p class="page-subtitle">View and manage loan plafond limits and interest rates.</p>
        </div>
        <div class="filter-actions">
            <button class="btn-primary" (click)="openAddModal()">
                <span class="material-icons-outlined">add</span>
                <span>Add Plafond</span>
            </button>
        </div>
    </div>

    <!-- STATS SUMMARY -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon bg-blue-100 text-blue-600">
                <span class="material-icons-outlined">monetization_on</span>
            </div>
            <div class="stat-info">
                <span class="stat-value">{{ plafonds().length }}</span>
                <span class="stat-label">Total Plafonds</span>
            </div>
        </div>
    </div>

    <!-- TABLE CARD -->
    <!-- Removed to make layout cleaner -->

    <!-- CONTENT -->
    <div class="content-wrapper">
        @if (isLoading()) {
        <div class="loading-container">
            <div class="loading-spinner"></div>
        </div>
        } @else if (filteredPlafonds().length === 0) {
        <div class="empty-state">
            <div class="empty-icon">
                <span class="material-icons-outlined">monetization_on</span>
            </div>
            <h3 class="empty-title">No Plafonds Found</h3>
            <p class="empty-message">No plafond data available at the moment</p>
        </div>
        } @else {
        <!-- DATA GRID -->
        <div class="plafond-grid-container">
            <div class="plafond-grid">
                @for (plafond of filteredPlafonds(); track plafond.id) {
                <div class="plafond-card-corporate">
                    <!-- Top Accent Line (Color coded by type) -->
                    <div class="card-accent" [ngClass]="getAccentClass(plafond.name)"></div>

                    <div class="card-main">
                        <!-- Header -->
                        <div class="card-header-corp">
                            <div class="header-icon-wrapper" [ngClass]="getIconClass(plafond.name)">
                                <span class="material-icons-outlined">workspace_premium</span>
                            </div>
                            <div class="header-text">
                                <h3 class="corp-title">{{ plafond.name }}</h3>
                                <span class="corp-subtitle">{{ plafond.description }}</span>
                            </div>
                        </div>

                        <!-- Key Metrics Row -->
                        <div class="metrics-container">
                            <div class="metric-box primary-metric">
                                <label>Maximum Limit</label>
                                <div class="value">{{ plafond.maxAmount | currency:'IDR':'IDR ':'1.0-0' }}</div>
                            </div>
                            <div class="metric-divider"></div>
                            <div class="metric-box secondary-metric">
                                <label>Interest Rate</label>
                                <div class="value text-highlight">{{ plafond.interestRate }}%</div>
                            </div>
                        </div>

                        <!-- Footer / Details -->
                        <div class="card-footer-corp">
                            <div class="detail-item">
                                <span class="material-icons-outlined">date_range</span>
                                <span>Tenor: <strong>{{ plafond.tenorMin }} - {{ plafond.tenorMax }}
                                        Months</strong></span>
                            </div>
                        </div>
                    </div>
                </div>
                }
            </div>
        </div>
        }
    </div>

    <!-- MODAL ADD PLAFOND -->
    @if (isAddModalOpen()) {
    <div class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3>Add New Plafond</h3>
                <button class="btn-close" (click)="closeAddModal()">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>

            <div class="modal-body">
                @if (errorMessage()) {
                <div class="error-alert" style="background: #fee2e2; color: #b91c1c; padding: 12px; border-radius: 8px; display: flex; align-items: center; gap: 8px; margin-bottom: 24px;">
                    <span class="material-icons-outlined">error</span>
                    <span>{{ errorMessage() }}</span>
                </div>
                }

                <div class="form-group">
                    <label>Plafond Name <span class="required">*</span></label>
                    <input type="text" [(ngModel)]="addPlafondForm().name" [class.error]="validationErrors()['name']"
                        placeholder="e.g. Gold, Platinum">
                    @if (validationErrors()['name']) {
                    <span class="error-text">{{ validationErrors()['name'] }}</span>
                    }
                </div>

                <div class="form-group">
                    <label>Description <span class="required">*</span></label>
                    <textarea [(ngModel)]="addPlafondForm().description" rows="3"
                        [class.error]="validationErrors()['description']"
                        placeholder="Brief description of the plafond tier"></textarea>
                    @if (validationErrors()['description']) {
                    <span class="error-text">{{ validationErrors()['description'] }}</span>
                    }
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Max Amount (IDR) <span class="required">*</span></label>
                        <input type="number" [(ngModel)]="addPlafondForm().maxAmount"
                            [class.error]="validationErrors()['maxAmount']">
                        @if (validationErrors()['maxAmount']) {
                        <span class="error-text">{{ validationErrors()['maxAmount'] }}</span>
                        }
                    </div>

                    <div class="form-group">
                        <label>Interest Rate (%) <span class="required">*</span></label>
                        <input type="number" step="0.1" [(ngModel)]="addPlafondForm().interestRate"
                            [class.error]="validationErrors()['interestRate']">
                        @if (validationErrors()['interestRate']) {
                        <span class="error-text">{{ validationErrors()['interestRate'] }}</span>
                        }
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Min Tenor (Months) <span class="required">*</span></label>
                        <input type="number" [(ngModel)]="addPlafondForm().tenorMin"
                            [class.error]="validationErrors()['tenorMin']">
                        @if (validationErrors()['tenorMin']) {
                        <span class="error-text">{{ validationErrors()['tenorMin'] }}</span>
                        }
                    </div>

                    <div class="form-group">
                        <label>Max Tenor (Months) <span class="required">*</span></label>
                        <input type="number" [(ngModel)]="addPlafondForm().tenorMax"
                            [class.error]="validationErrors()['tenorMax']">
                        @if (validationErrors()['tenorMax']) {
                        <span class="error-text">{{ validationErrors()['tenorMax'] }}</span>
                        }
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="btn-secondary" (click)="closeAddModal()">Cancel</button>
                    <button class="btn-primary" (click)="submitAddPlafond()" [disabled]="isSubmitting()">
                        @if (isSubmitting()) {
                        <span class="spinner-small"></span> Saving...
                        } @else {
                        Save Plafond
                        }
                    </button>
                </div>
            </div>
        </div>
    </div>
    }

</div>
